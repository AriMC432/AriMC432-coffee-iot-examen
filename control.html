<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Control - Coffee IoT</title>
  <link rel="icon" type="image/x-icon" href="img/favicon.ico">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="estilos.css" />
</head>

<body class="bg-cafe">
  <nav class="navbar navbar-expand-lg navbar-dark barra-cafe">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">Coffee IoT</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto gap-2">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="admin.html">Admin</a></li>
          <li class="nav-item"><a class="nav-link active" href="control.html">Control</a></li>
          <li class="nav-item"><a class="nav-link" href="monitoreo.html">Monitoreo</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="py-5">
    <div class="container">
      <div class="tarjeta-vidrio p-4">

        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
          <div>
            <h3 class="text-white mb-0">Control de cafeterías</h3>
            <div class="text-white-50 small">Cada cafetería tiene su panel y sus propios estados.</div>
          </div>
          <div class="d-flex gap-2 align-items-center">
            <button id="btnRefrescarTodo" class="btn btn-light fw-semibold">Refrescar</button>
            <span class="badge text-bg-info">Auto: 2s</span>
            <span id="estadoConexion" class="badge rounded-pill text-bg-warning">Conectando...</span>
          </div>
        </div>

        <!-- AQUÍ SE PINTAN TODAS LAS CAFETERÍAS -->
        <div id="cafeteriasContainer"></div>

      </div>
    </div>
  </main>
  <footer class="footer-cafe py-4 mt-auto">
    <div class="container text-center">
      <div class="text-white-50 small">
        <div>Coffee IoT · Panel de control y monitoreo · 2026</div>
        <div>Autor: Ariana Muñoz Castillo</div>
        <div>
          <a href="https://www.linkedin.com/in/ariana-muñoz-castillo-0a817b381"
             target="_blank"
             class="text-white text-decoration-none">
            Linkedin: www.linkedin.com/in/ariana-muñoz-castillo-0a817b381
          </a>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
/* =========================================================
   CONTROL (imagen + interruptores) MULTI CAFETERÍAS
   - GET/PUT: /cafeterias
   - POST: /historial_estados
   - Alertas:
     * Cafetera: filtro y agua > 30s
     * Crepera: temp > 235
   ========================================================= */

const API_BASE = "https://698a18b7c04d974bc6a1598e.mockapi.io/api/v1";
const API_CAF  = `${API_BASE}/cafeterias`;
const API_HIST = `${API_BASE}/historial_estados`;

const $wrap = document.getElementById("cafeteriasContainer");
const $estadoConexion = document.getElementById("estadoConexion");
const $btnRefrescarTodo = document.getElementById("btnRefrescarTodo");

let CAF_LIST = [];

const nowISO = () => new Date().toISOString();
const toMs = (iso) => iso ? new Date(iso).getTime() : 0;

function setConexion(ok){
  if(!$estadoConexion) return;
  if(ok){
    $estadoConexion.textContent = "Conectado";
    $estadoConexion.className = "badge rounded-pill text-bg-success";
  }else{
    $estadoConexion.textContent = "Error API";
    $estadoConexion.className = "badge rounded-pill text-bg-danger";
  }
}

const CAF_ITEMS = [
  { key:"purga",      label:"Purgación de lanceta", alerta30:false },
  { key:"lanceta",    label:"Lanceta para cremar leche", alerta30:false },
  { key:"extraccion", label:"Extracción del café", alerta30:false },
  { key:"filtro",     label:"Filtro de café", alerta30:true },
  { key:"agua",       label:"Salida de agua caliente", alerta30:true },
];

function asegurarEstructura(c){
  c.dispositivos = c.dispositivos || {};
  c.dispositivos.cafetera = c.dispositivos.cafetera || {};
  c.dispositivos.crepera  = c.dispositivos.crepera  || {};
  c.dispositivos.molino   = c.dispositivos.molino   || {};

  const caf = c.dispositivos.cafetera;
  caf.tipo = "cafetera";
  caf.nombre = caf.nombre || `CAFETERA ${c.nombre || ""}`.trim();
  caf.estado = caf.estado || "apagada";
  caf.variables = caf.variables || {};
  for(const it of CAF_ITEMS){
    const k = `${it.key}_on`;
    if(typeof caf.variables[k] !== "boolean") caf.variables[k] = false;

    if(it.alerta30){
      const ks = `${it.key}_on_since`;
      if(!(ks in caf.variables)) caf.variables[ks] = null;
    }
  }
  caf.alerta_activa = Boolean(caf.alerta_activa);
  caf.mensaje_alerta = caf.mensaje_alerta || "";

  const cre = c.dispositivos.crepera;
  cre.tipo = "crepera";
  cre.nombre = cre.nombre || `CREPERA ${c.nombre || ""}`.trim();
  cre.estado = cre.estado || "apagada";
  cre.variables = cre.variables || {};
  if(typeof cre.variables.temperatura_c !== "number") cre.variables.temperatura_c = 0;
  cre.alerta_activa = Boolean(cre.alerta_activa);
  cre.mensaje_alerta = cre.mensaje_alerta || "";

  const mol = c.dispositivos.molino;
  mol.tipo = "molino";
  mol.nombre = mol.nombre || `MOLINO ${c.nombre || ""}`.trim();
  mol.estado = mol.estado || "molienda_medio";
  mol.variables = mol.variables || {};
  mol.variables.molienda_tipo = mol.variables.molienda_tipo || "medio";
  mol.alerta_activa = false;
  mol.mensaje_alerta = "";

  if(typeof c.activa !== "boolean") c.activa = true;
  c.actualizado_en = c.actualizado_en || nowISO();
  return c;
}

/* =========================
   ALERTAS (REGLAS EXACTAS)
========================= */
// Cafetera: SOLO filtro y agua > 30s
function evaluarAlertaCafetera(caf){
  const v = caf.variables || {};
  const alertas = [];
  const now = Date.now();

  for(const it of CAF_ITEMS){
    if(!it.alerta30) continue;

    const on = Boolean(v[`${it.key}_on`]);
    const sinceKey = `${it.key}_on_since`;

    if(on){
      const ms = toMs(v[sinceKey]);
      if(!ms){
        v[sinceKey] = nowISO();
      }else if(now - ms >= 30000){
        alertas.push(`${it.label} > 30 s (apagar para evitar daños)`);
      }
    }else{
      v[sinceKey] = null;
    }
  }

  caf.alerta_activa = alertas.length > 0;
  caf.mensaje_alerta = alertas.join(" | ");
}

// Crepera: SOLO si temp > 235
function evaluarAlertaCrepera(cre){
  const t = Number(cre.variables?.temperatura_c ?? 0);
  const alerta = t > 235;
  cre.alerta_activa = alerta;
  cre.mensaje_alerta = alerta ? `Temperatura > 235°C (${t}°C)` : "";
}

// Molino nunca alerta
function limpiarAlertaMolino(mol){
  mol.alerta_activa = false;
  mol.mensaje_alerta = "";
}

/* =========================
   HISTORIAL
========================= */
async function pushHistorial({ cafeteria, dispositivo, estado, mensaje, alerta_activa, variables }){
  const payload = {
    cafeteria_id: String(cafeteria.id ?? ""),
    cafeteria_nombre: cafeteria.nombre || "",
    dispositivo_tipo: dispositivo.tipo || "",
    dispositivo_nombre: dispositivo.nombre || "",
    estado: estado || "",
    alerta_activa: Boolean(alerta_activa),
    mensaje: mensaje || "",
    fecha_hora: nowISO(),
    variables: variables || {}
  };

  try{
    await fetch(API_HIST,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
  }catch(e){
    console.warn("Historial no pudo guardarse", e);
  }
}

/* =========================
   API
========================= */
async function getCafeterias(){
  const r = await fetch(API_CAF);
  if(!r.ok) throw new Error("No se pudo leer cafeterias");
  const data = await r.json();
  return (Array.isArray(data) ? data : []).map(asegurarEstructura);
}

async function putCafeteria(id, cafeteria){
  const r = await fetch(`${API_CAF}/${id}`,{
    method:"PUT",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(cafeteria)
  });
  if(!r.ok) throw new Error("No se pudo actualizar cafetería");
  return await r.json();
}

/* =========================
   UI helpers (bonito)
========================= */
function estadoCafeteraBonito(caf){
  const v = caf.variables || {};
  const activos = CAF_ITEMS.filter(it => v[`${it.key}_on`]).map(it => it.label);
  return activos.length ? `encendida: ${activos.join(", ")}` : "apagada";
}

function estadoCreperaBonito(cre){
  const t = Number(cre.variables?.temperatura_c ?? 0);
  if(t === 0) return "apagada — 0°C";
  return `${cre.estado} — ${t}°C`;
}

function estadoMolinoBonito(mol){
  return mol.estado || `molienda_${mol.variables?.molienda_tipo || "medio"}`;
}

function colorPorTemp(t){
  t = Number(t);
  if(t === 0) return "rgba(180,180,180,0.95)";
  if(t >= 160 && t < 195) return "rgba(0,180,255,0.95)";
  if(t >= 195 && t <= 235) return "rgba(0,220,120,0.95)";
  if(t > 235) return "rgba(255,70,70,0.98)";
  return "rgba(255,200,0,0.95)";
}

function actualizarGauge(panelEl, t){
  const txt = panelEl.querySelector("[data-role='gaugeTxt']");
  const aguja = panelEl.querySelector("[data-role='gaugeAguja']");
  const prog = panelEl.querySelector("[data-role='gaugeProg']");
  const temp = Number(t);

  if(txt) txt.textContent = `${temp}°C`;

  const ang = -90 + (temp * 180 / 260);
  if(aguja) aguja.setAttribute("transform", `rotate(${ang} 100 100)`);

  const total = 252;
  const avance = Math.max(0, Math.min(total, (temp/260) * total));
  if(prog){
    prog.setAttribute("stroke-dashoffset", String(total - avance));
    prog.setAttribute("stroke", colorPorTemp(temp));
  }
}

/* =========================
   RENDER de cada cafetería
========================= */
function cafeteriaHTML(c){
  const caf = c.dispositivos.cafetera;
  const cre = c.dispositivos.crepera;
  const mol = c.dispositivos.molino;

  const v = caf.variables || {};
  const tempCre = Number(cre.variables?.temperatura_c ?? 0);
  const molienda = mol.variables?.molienda_tipo || "medio";

  return `
  <div class="mb-4" data-caf-card="${c.id}">
    <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-2">
      <div>
        <h4 class="text-white mb-0">${c.nombre || "CAFETERÍA"}</h4>
        <div class="text-white-50 small">
          Activa: <b>${c.activa ? "Sí" : "No"}</b> · Actualizado: ${c.actualizado_en ? new Date(c.actualizado_en).toLocaleString() : "—"}
        </div>
      </div>
      <button class="btn btn-warning fw-semibold" data-action="toggle-activa" data-cafid="${c.id}">
        ${c.activa ? "Dar de baja" : "Dar de alta"}
      </button>
    </div>

    <div class="row g-4 align-items-start">
      <!-- PANEL CON IMAGEN -->
      <div class="col-lg-8">
        <div class="panel-iot" data-panel="${c.id}">
          <img src="img/panel.jpeg" class="img-fluid rounded-4" alt="Panel IoT Cafetería">

          <!-- CAFETERA (interruptores) -->
          ${CAF_ITEMS.map(it => `
            <div class="grupo g-${it.key}">
              <button class="btn btn-sm ${v[`${it.key}_on`] ? "btn-success" : "btn-outline-success"}"
                      data-action="caf-on" data-cafid="${c.id}" data-key="${it.key}">I</button>
              <button class="btn btn-sm ${v[`${it.key}_on`] ? "btn-outline-danger" : "btn-danger"}"
                      data-action="caf-off" data-cafid="${c.id}" data-key="${it.key}">O</button>
            </div>
          `).join("")}

          <!-- CREPERA -->
          <div class="grupo g-crepera g-crepera-vertical">
            <div class="lbl lbl-top">Crepera</div>

            <div class="crepera-gauge">
              <svg class="crepera-svg" viewBox="0 0 200 120" aria-label="Medidor de temperatura">
                <path d="M20,100 A80,80 0 0 1 180,100"
                      fill="none" stroke="rgba(255,255,255,0.18)"
                      stroke-width="14" stroke-linecap="round"/>
                <path data-role="gaugeProg" d="M20,100 A80,80 0 0 1 180,100"
                      fill="none" stroke="rgba(255,200,0,0.9)"
                      stroke-width="14" stroke-linecap="round"
                      stroke-dasharray="252" stroke-dashoffset="252"/>
                <line data-role="gaugeAguja" x1="100" y1="100" x2="100" y2="35"
                      stroke="rgba(255,255,255,0.9)"
                      stroke-width="4" stroke-linecap="round"/>
                <circle cx="100" cy="100" r="6" fill="rgba(255,255,255,0.85)"/>
                <text data-role="gaugeTxt" x="100" y="115" text-anchor="middle"
                      fill="white" font-size="14">0°C</text>
              </svg>
            </div>

            <div class="crepera-slider">
              <input type="range" min="0" max="260" value="${tempCre}" class="form-range"
                     data-action="cre-slider" data-cafid="${c.id}">
            </div>

            <div class="crepera-botones-row">
              <button class="btn btn-warning btn-sm" data-action="cre-temp" data-cafid="${c.id}" data-temp="160">160</button>
              <button class="btn btn-warning btn-sm" data-action="cre-temp" data-cafid="${c.id}" data-temp="210">210</button>
              <button class="btn btn-danger  btn-sm" data-action="cre-temp" data-cafid="${c.id}" data-temp="250">Max</button>
              <button class="btn btn-secondary btn-sm" data-action="cre-temp" data-cafid="${c.id}" data-temp="0">OFF</button>
            </div>
          </div>

          <!-- MOLINO -->
          <div class="grupo g-molino">
            <div class="lbl">Molino</div>
            <div class="molino-grid">
              ${["grueso","medio","fino","extra_fino"].map(x => `
                <button class="btn btn-sm ${molienda===x ? "btn-success" : "btn-secondary"}"
                        data-action="mol" data-cafid="${c.id}" data-mol="${x}">
                  ${x.replace("_"," ")}
                </button>
              `).join("")}
            </div>
          </div>

        </div>
      </div>

      <!-- ESTATUS EN VIVO (de ESTA cafetería) -->
      <div class="col-lg-4">
        <div class="tarjeta-vidrio p-3">
          <h5 class="text-white mb-3">Estatus · ${c.nombre || ""}</h5>

          <div class="mb-3">
            <div class="text-white-50 small">${caf.nombre}</div>
            <div class="text-white fw-semibold">${estadoCafeteraBonito(caf)}</div>
            <div class="text-warning small">${caf.alerta_activa ? ("⚠ " + caf.mensaje_alerta) : ""}</div>
          </div>

          <div class="mb-3">
            <div class="text-white-50 small">${cre.nombre}</div>
            <div class="text-white fw-semibold">${estadoCreperaBonito(cre)}</div>
            <div class="text-warning small">${cre.alerta_activa ? ("⚠ " + cre.mensaje_alerta) : ""}</div>
          </div>

          <div class="mb-0">
            <div class="text-white-50 small">${mol.nombre}</div>
            <div class="text-white fw-semibold">${estadoMolinoBonito(mol)}</div>
            <div class="text-warning small"></div>
          </div>

        </div>
      </div>
    </div>
  </div>
  `;
}

/* =========================
   Render general
========================= */
function renderAll(lista){
  if(!$wrap) return;

  if(!lista.length){
    $wrap.innerHTML = `<div class="text-white-50">No hay cafeterías. Ve a Admin y agrega una.</div>`;
    return;
  }

  $wrap.innerHTML = lista.map(cafeteriaHTML).join("");

  // actualizar gauges después de pintar HTML
  lista.forEach(c=>{
    const panel = document.querySelector(`[data-panel="${c.id}"]`);
    if(panel){
      const t = Number(c.dispositivos?.crepera?.variables?.temperatura_c ?? 0);
      actualizarGauge(panel, t);
    }
  });
}

/* =========================
   Acciones (delegación)
========================= */
async function onClick(e){
  const btn = e.target.closest("[data-action]");
  if(!btn) return;

  const action = btn.getAttribute("data-action");
  const cafId = btn.getAttribute("data-cafid");
  const cafeteria = CAF_LIST.find(x => String(x.id) === String(cafId));
  if(!cafeteria) return;

  // si está dada de baja, no dejamos controlar (como regla)
  if(action !== "toggle-activa" && cafeteria.activa === false) return;

  try{
    if(action === "toggle-activa"){
      cafeteria.activa = !cafeteria.activa;
      cafeteria.actualizado_en = nowISO();
      await putCafeteria(cafId, cafeteria);
      await cargarTodo();
      return;
    }

    // CAFETERA ON/OFF
    if(action === "caf-on" || action === "caf-off"){
      const key = btn.getAttribute("data-key");
      const prop = `${key}_on`;
      cafeteria.dispositivos.cafetera.variables[prop] = (action === "caf-on");

      // recalcular alertas
      evaluarAlertaCafetera(cafeteria.dispositivos.cafetera);
      evaluarAlertaCrepera(cafeteria.dispositivos.crepera);
      limpiarAlertaMolino(cafeteria.dispositivos.molino);

      cafeteria.actualizado_en = nowISO();
      await putCafeteria(cafId, cafeteria);

      await pushHistorial({
        cafeteria,
        dispositivo: cafeteria.dispositivos.cafetera,
        estado: estadoCafeteraBonito(cafeteria.dispositivos.cafetera),
        mensaje: `Cafetera → ${key} ${(action==="caf-on") ? "ON" : "OFF"}`,
        alerta_activa: cafeteria.dispositivos.cafetera.alerta_activa,
        variables: cafeteria.dispositivos.cafetera.variables
      });

      await cargarTodo();
      return;
    }

    // CREPERA PRESET
    if(action === "cre-temp"){
      const t = Number(btn.getAttribute("data-temp"));
      cafeteria.dispositivos.crepera.variables.temperatura_c = t;

      // estados que tú usabas
      if(t === 0) cafeteria.dispositivos.crepera.estado = "apagada";
      else if(t >= 160 && t < 195) cafeteria.dispositivos.crepera.estado = "en_espera";
      else if(t >= 195 && t <= 235) cafeteria.dispositivos.crepera.estado = "en_funcion";
      else cafeteria.dispositivos.crepera.estado = "en_funcion";

      evaluarAlertaCrepera(cafeteria.dispositivos.crepera);
      evaluarAlertaCafetera(cafeteria.dispositivos.cafetera);
      limpiarAlertaMolino(cafeteria.dispositivos.molino);

      cafeteria.actualizado_en = nowISO();
      await putCafeteria(cafId, cafeteria);

      await pushHistorial({
        cafeteria,
        dispositivo: cafeteria.dispositivos.crepera,
        estado: estadoCreperaBonito(cafeteria.dispositivos.crepera),
        mensaje: `Crepera → ${t}°C`,
        alerta_activa: cafeteria.dispositivos.crepera.alerta_activa,
        variables: cafeteria.dispositivos.crepera.variables
      });

      await cargarTodo();
      return;
    }

    // MOLINO
    if(action === "mol"){
      const m = btn.getAttribute("data-mol");
      cafeteria.dispositivos.molino.variables.molienda_tipo = m;
      cafeteria.dispositivos.molino.estado = `molienda_${m}`;
      limpiarAlertaMolino(cafeteria.dispositivos.molino);

      cafeteria.actualizado_en = nowISO();
      await putCafeteria(cafId, cafeteria);

      await pushHistorial({
        cafeteria,
        dispositivo: cafeteria.dispositivos.molino,
        estado: estadoMolinoBonito(cafeteria.dispositivos.molino),
        mensaje: `Molino → ${m}`,
        alerta_activa: false,
        variables: cafeteria.dispositivos.molino.variables
      });

      await cargarTodo();
      return;
    }

  }catch(err){
    console.error(err);
    setConexion(false);
  }
}

async function onInput(e){
  const el = e.target.closest("[data-action='cre-slider']");
  if(!el) return;

  const cafId = el.getAttribute("data-cafid");
  const cafeteria = CAF_LIST.find(x => String(x.id) === String(cafId));
  if(!cafeteria || cafeteria.activa === false) return;

  const t = Number(el.value);
  cafeteria.dispositivos.crepera.variables.temperatura_c = t;

  // estados
  if(t === 0) cafeteria.dispositivos.crepera.estado = "apagada";
  else if(t >= 160 && t < 195) cafeteria.dispositivos.crepera.estado = "en_espera";
  else if(t >= 195 && t <= 235) cafeteria.dispositivos.crepera.estado = "en_funcion";
  else cafeteria.dispositivos.crepera.estado = "en_funcion";

  // actualizar gauge en vivo (sin pegar al API cada milisegundo)
  const panel = document.querySelector(`[data-panel="${cafId}"]`);
  if(panel) actualizarGauge(panel, t);
}

async function onChange(e){
  const el = e.target.closest("[data-action='cre-slider']");
  if(!el) return;

  const cafId = el.getAttribute("data-cafid");
  const cafeteria = CAF_LIST.find(x => String(x.id) === String(cafId));
  if(!cafeteria || cafeteria.activa === false) return;

  try{
    evaluarAlertaCrepera(cafeteria.dispositivos.crepera);
    cafeteria.actualizado_en = nowISO();
    await putCafeteria(cafId, cafeteria);

    await pushHistorial({
      cafeteria,
      dispositivo: cafeteria.dispositivos.crepera,
      estado: estadoCreperaBonito(cafeteria.dispositivos.crepera),
      mensaje: `Crepera → ${Number(el.value)}°C`,
      alerta_activa: cafeteria.dispositivos.crepera.alerta_activa,
      variables: cafeteria.dispositivos.crepera.variables
    });

    await cargarTodo();
  }catch(err){
    console.error(err);
    setConexion(false);
  }
}

/* =========================
   Auto-alerta por tiempo
   - si filtro/agua pasan a alerta por tiempo, lo guarda
========================= */
async function aplicarAlertasPorTiempoYGuardar(lista){
  for(const c of lista){
    const caf = c.dispositivos.cafetera;

    const before = Boolean(caf.alerta_activa);
    evaluarAlertaCafetera(caf);
    const after = Boolean(caf.alerta_activa);

    // también evalúa crepera
    evaluarAlertaCrepera(c.dispositivos.crepera);
    limpiarAlertaMolino(c.dispositivos.molino);

    // Si se ACTIVÓ la alerta por tiempo, guardamos en API + historial
    if(!before && after){
      c.actualizado_en = nowISO();
      try{
        await putCafeteria(c.id, c);
        await pushHistorial({
          cafeteria: c,
          dispositivo: caf,
          estado: estadoCafeteraBonito(caf),
          mensaje: "ALERTA por tiempo (filtro/agua > 30s)",
          alerta_activa: true,
          variables: caf.variables
        });
      }catch{}
    }
  }
}

/* =========================
   CARGA PRINCIPAL
========================= */
async function cargarTodo(){
  try{
    setConexion(true);
    CAF_LIST = await getCafeterias();

    // auto-alertas por tiempo
    await aplicarAlertasPorTiempoYGuardar(CAF_LIST);

    renderAll(CAF_LIST);
    setConexion(true);
  }catch(err){
    console.error(err);
    setConexion(false);
    if($wrap) $wrap.innerHTML = `<div class="text-white-50">Error cargando cafeterías.</div>`;
  }
}

// listeners
document.addEventListener("click", onClick);
document.addEventListener("input", onInput);
document.addEventListener("change", onChange);
$btnRefrescarTodo?.addEventListener("click", cargarTodo);

// init + auto
cargarTodo();
setInterval(cargarTodo, 2000);
  </script>
</body>
</html>
